Object.extend(String.English,{});Client=SC.Object.create({server:SC.Server.create({prefix:["Client"],urlFormat:"/server/%@/%@/%@"}),FIXTURES:[]});Client.server.set("urlFormat","/server/%@/%@/%@");require("core");Client.analyzeController=SC.Object.create({sourceLayer:"",compareMethod:"",compareLayer:"",availableCompareMethods:["Contains","Within","Intersects"],newLayerName:"",newLayerTableName:"",sourceLayerFields:[],compareLayerFields:[],numConditions:0,performAnalysis:function(){var a=new Hash();a.set("sourceLayerID",this.sourceLayer);a.set("compareMethodName",this.compareMethod);a.set("compareLayerID",this.compareLayer);a.set("newLayerName",this.newLayerName);a.set("newLayerTableName",this.newLayerTableName);a.set("conditions",this.getConditions());new Ajax.Request("/server/query/new",{parameters:"json="+a.toJSON(),asynchronous:true,evalScripts:true})},generateFieldMenu:function(){var a=document.createElement("li");a.innerHTML="<div class = 'analyze_condition>"+Client.applicationController.buildSelect("name",this.get("sourceLayerFields").concat(this.get("compareLayerFields")))+" "+Client.applicationController.buildSelect("operation",["greater","greater_equal","equal","less","less_equal"])+'<input class = "conditions'+this.get("numConditions")+' name = "blah" type = "text" />';$("conditions_list").appendChild(a)+"</div>"},addCondition:function(){new Ajax.Request("/resources/layers/get_layers_fields/"+this.get("sourceLayer")+","+this.get("compareLayer")+",",{onSuccess:function(a){resultsHash=a.responseText.evalJSON().results;this.set("sourceLayerFields",resultsHash[parseInt(this.get("sourceLayer"))]);this.set("compareLayerFields",resultsHash[parseInt(this.get("compareLayer"))]);this.generateFieldMenu()}.bind(this)})},getConditions:function(){var a=[];$$(".analyze_condition").each(function(c){var b=Form.getElements(c);a.push({field:$F(b[0]),operation:$F(b[1]),value:$F(b[2])})});return a}});require("core");Client.layerMasterController=SC.CollectionController.create({allowsEmptySelection:false,allowsMultipleSelection:false,layersVisible:YES,layersVisibleObserver:function(){SC.page.workspace.layout()}.observes("layersVisible"),layerNames:function(){return this.arrangedObjects.collect(function(a){return a.get("name")})},layerSelectObjects:function(){return this.arrangedObjects.collect(function(a){return[a.get("guid"),a.get("name")]})}});require("core");Client.serverController=SC.Object.create({server:function(a,b){new Ajax.Request("resources/"+a,{onSuccess:function(c){result=c.responseText.evalJSON().results;b(result)}})},get:function(b,a,c){this.server(("get/"+a+"/"+b.join(",")),c)},getLayer:function(b,a){this.server(("layer/get_layer/"+b),a)},get:function(a,b){this.server((a+"/get_all/0"),b)},getAllPaginated:function(c,a,b,d){this.server(c+"get_all_paginated/"+[a,b].join(","),d)},get_layers_fields:function(a,b){this.server(("get_layers_fields/"+a.join(",")),b)}});require("core");Client.mapController=SC.Object.create({getMap:function(){return GMap2(document.getElementById("map"))},clearMap:function(){this.getMap.clearOverlays()}});require("core");Client.applicationController=SC.Object.create({importPickerIsVisible:false,importIsVisibile:false,analyzeIsVisibile:false,rightViewName:"",layerA:"",left:"700",showImportPicker:function(){this.set("importPickerIsVisible",true)},hideImportPicker:function(){this.set("importPickerIsVisible",false)},showImportPane:function(){this.set("rightViewName","import");this.set("importIsVisibile",true)},hideImportPane:function(){this.set("importIsVisibile",false)},showAnalyzePane:function(){this.set("rightViewName","analyze");this.set("analyzeIsVisibile",true)},hideAnalyzePane:function(){this.set("analyzeIsVisibile",false)},rightView:function(){var a=this.get("rightViewName").dasherize().camelize();return SC.page.get(a)}.property("rightViewName"),test:function(){alert("You selected: "+this.layerA)},showDataView:function(){new TableOrderer("container4",{data:Client.layerDetailController.layerData,filter:"bottom"})},buildSelect:function(c,b){var a='<select class="'+c+'">';b.each(function(d){a=a+'<option value = "'+d+'">'+d+"</option>"});a=a+"</select>";return a},dataGrid:[]});require("core");Client.LayerListView=SC.View.extend({emptyElement:"<table><tr><td></td></tr></table>",content:[],contentBindingDefault:SC.Binding.MultipleNotEmpty,render:function(){var a=[];var b=this.get("content");a.push("<table>");a.push(this._renderRowHtml(b));a.push("</table>");a=a.join("");this.set("innerHTML",a)}.observes("content"),_renderRowHtml:function(b){var a=[];b.each(function(c){a.push("<tr>");var d=c.get("properties").length;for(i=0;i<d;i++){a.push("<td>");a.push(c.get(c.get("properties")[i]));a.push("</td>")}a.push("</tr>")});return a.join("")}});require("core");Client.ImportLayerView=SC.View.extend({});function main(){Client.server.listFor({recordType:Client.Layer});SC.page.awake();var a=Client.Layer.collection();Client.layerMasterController.set("content",a);a.refresh()}require("core");Client.Layer=SC.Record.extend({dataSource:Client.server,resourceURL:"layers",properties:["guid","name","tableName","categoryId"],primaryKey:"guid",icon:function(){return(this.get("listingType")=="Layer")?"sc-icon-document-16":"sc-icon-document-16"}.property("listingType"),listingType:"Layers"});require("core");Client.layerDetailController=SC.ObjectController.create({contentBinding:"Client.layerMasterController.selection",commitChangesImmediately:false,changed:1,columnNames:[],features:[],layerData:[],selectLayer:function(){Client.layerDetailController.changed++;if(Client.layerDetailController.changed>4){this.drawLayer();this.getFeatures()}}.observes("selection"),drawLayer:function(){new Ajax.Request("server/layers/display?layer_name="+this.get("tableName"),{asynchronous:true,evalScripts:true})},getFeatures:function(){this.getData()},getData:function(){Client.serverController.getLayer(this.get("guid"),function(a){this.set("layerData",a)}.bind(this))}.property("layerDaya","guid")});