Object.extend(String.English,{});Client=SC.Object.create({server:SC.Server.create({prefix:["Client"],urlFormat:"/server/%@/%@/%@"}),FIXTURES:[]});Client.server.set("urlFormat","/server/%@/%@/%@");require("core");Client.Receiver=SC.Record.extend({initialize:function(){alert("hello!")}});require("core");Client.receiverController=SC.Object.create({numReceivers:0,addReceiver:function(a,b,c){this.numReceivers+=1;new PeriodicalExecuter(function(d){Client.receiverController.checkStatus(a,c,d)}.bind(a,c),b)},checkStatus:function(b,c,a){Client.serverController.checkNotifier(b,this.evaluateNotification)},evaluateNotification:function(a){if(a.status==true){pe.stop();alert(a);numReceivers-=1}}});require("core");Client.analyzeController=SC.Object.create({sourceLayer:"",compareMethod:"",compareLayer:"",availableCompareMethods:["Contains","Within","Intersects"],newLayerName:"",newLayerTableName:"",sourceLayerFields:[],compareLayerFields:[],numConditions:0,performAnalysis:function(){var a=new Hash();a.set("sourceLayerID",this.sourceLayer);a.set("compareMethodName",this.compareMethod);a.set("compareLayerID",this.compareLayer);a.set("newLayerName",this.newLayerName);a.set("newLayerTableName",this.newLayerTableName);a.set("conditions",this.getConditions());new Ajax.Request("/server/query/new",{parameters:"json="+a.toJSON()})},generateFieldMenu:function(){var a=document.createElement("li");a.innerHTML="<div class = 'analyze_condition>"+Client.applicationController.buildSelect("name",this.get("sourceLayerFields").concat(this.get("compareLayerFields")))+" "+Client.applicationController.buildSelect("operation",["greater","greater_equal","equal","less","less_equal"])+'<input class = "conditions'+this.get("numConditions")+' name = "blah" type = "text" />';$("conditions_list").appendChild(a)+"</div>"},addCondition:function(){new Ajax.Request("/server/layers/fields/"+this.get("sourceLayer")+","+this.get("compareLayer")+",",{onSuccess:function(a){resultsHash=a.responseText.evalJSON().results;this.set("sourceLayerFields",resultsHash[parseInt(this.get("sourceLayer"))]);this.set("compareLayerFields",resultsHash[parseInt(this.get("compareLayer"))]);this.generateFieldMenu()}.bind(this)})},getConditions:function(){var a=[];$$(".analyze_condition").each(function(c){var b=Form.getElements(c);a.push({field:$F(b[0]),operation:$F(b[1]),value:$F(b[2])})});return a}});require("core");Client.layerMasterController=SC.CollectionController.create({allowsEmptySelection:true,allowsMultipleSelection:false,layersVisible:YES,layersVisibleObserver:function(){SC.page.workspace.layout()}.observes("layersVisible"),layerNames:function(){return this.arrangedObjects.collect(function(a){return a.get("name")})},layerSelectObjects:function(){return this.arrangedObjects.collect(function(a){return[a.get("guid"),a.get("name")]})},afterLayerAdded:function(){this.refresh(function(){this.set("selection",this.arrangedObjects.last())})},refresh:function(a){Client.server.listFor({recordType:Client.Layer,onSuccess:a})},refresh:function(){Client.server.listFor({recordType:Client.Layer})}});require("core");Client.serverController=SC.Object.create({server:function(a,b){new Ajax.Request("server/"+a,{onSuccess:function(c){result=c.responseText.evalJSON().results;b(result)}})},get:function(b,a,c){this.server((a+"/get//"+b.join(",")),c)},checkNotifier:function(a){this.server("notifications/"+a,callback)},getLayer:function(b,a){this.server(("layers/get_layer/"+b),a)},get:function(a,b){this.server((a+"/get_all/0"),b)},getAllPaginated:function(c,e,a,b,d){this.server(c+"/get_all_paginated/"+[e,b,a].join(","),d)},get_layers_fields:function(a,b){this.server(("layers/get_layers_fields/"+a.join(",")),b)}});require("core");Client.mapController=SC.Object.create({getMap:function(){return GMap2(document.getElementById("map"))},clearMap:function(){this.getMap.clearOverlays()}});require("core");Client.importController=SC.Object.create({current:"layerDetails",showPanel:function(){window.open("http://localhost:3000/imports/new","Import New Layer","location=no,directories=no,menubar=no,width=430,height=550,toolbar=no")},hidePanel:function(){}});require("core");Client.datagridController=SC.ObjectController.create({currentData:[],numberOfPages:0,itemsPerPage:10,currentPage:1,count:0,pages:0,contentBinding:"Client.layerMasterController.selection",datagrid:"",selectLayer:function(){if(Client.layerDetailController.changed>3){this.requestData()}}.observes("selection"),requestData:function(){Client.serverController.getAllPaginated("Layers",this.get("guid"),this.get("currentPage"),this.get("itemsPerPage"),function(a){this.updatePageData(a);this.updateDataGrid()}.bind(this))},updatePageData:function(a){this.set("currentData",a.items);this.set("count",a.count);this.set("pages",a.pages);this.set("currentPage",a.current_page)},updateDataGrid:function(){new TableOrderer("datagrid",{data:this.get("currentData"),filter:"bottom"})}.property("currentData")});require("core");Client.applicationController=SC.Object.create({importPanelIsVisible:false,importIsVisibile:false,analyzeIsVisibile:false,rightViewName:"",layerA:"",left:"700",showImportPane:function(){this.set("importPanelIsVisible",true)},hideImportPane:function(){this.set("importPanelIsVisible",false)},showAnalyzePane:function(){this.set("rightViewName","analyze");this.set("analyzeIsVisibile",true)},hideAnalyzePane:function(){this.set("analyzeIsVisibile",false)},rightView:function(){var a=this.get("rightViewName").dasherize().camelize();return SC.page.get(a)}.property("rightViewName"),test:function(){alert("You selected: "+this.layerA)},buildSelect:function(c,b){var a='<select class="'+c+'">';b.each(function(d){a=a+'<option value = "'+d+'">'+d+"</option>"});a=a+"</select>";return a},dataGrid:[]});require("core");Client.LayerListView=SC.View.extend({emptyElement:"<table><tr><td></td></tr></table>",content:[],contentBindingDefault:SC.Binding.MultipleNotEmpty,render:function(){var a=[];var b=this.get("content");a.push("<table>");a.push(this._renderRowHtml(b));a.push("</table>");a=a.join("");this.set("innerHTML",a)}.observes("content"),_renderRowHtml:function(b){var a=[];b.each(function(c){a.push("<tr>");var d=c.get("properties").length;for(i=0;i<d;i++){a.push("<td>");a.push(c.get(c.get("properties")[i]));a.push("</td>")}a.push("</tr>")});return a.join("")}});require("core");Client.ImportLayerView=SC.View.extend({});function main(){Client.server.listFor({recordType:Client.Layer});SC.page.awake();var a=Client.Layer.collection();Client.layerMasterController.set("content",a);a.refresh()}require("core");Client.Layer=SC.Record.extend({dataSource:Client.server,resourceURL:"layers",properties:["guid","name","tableName","categoryId"],primaryKey:"guid",icon:function(){return(this.get("listingType")=="Layer")?"sc-icon-document-16":"sc-icon-document-16"}.property("listingType"),listingType:"Layers"});require("core");Client.layerDetailController=SC.ObjectController.create({contentBinding:"Client.layerMasterController.selection",commitChangesImmediately:false,changed:1,columnNames:[],features:[],layerData:[],selectLayer:function(){Client.layerDetailController.changed++;if(Client.layerDetailController.changed>4){this.drawLayer();this.getFeatures()}}.observes("selection"),drawLayer:function(){new Ajax.Request("server/layers/display?layer_name="+this.get("tableName"),{asynchronous:true,evalScripts:true})},getFeatures:function(){this.getData()},getData:function(){Client.serverController.getLayer(this.get("guid"),function(a){this.set("layerData",a)}.bind(this))}.property("layerDaya","guid")});